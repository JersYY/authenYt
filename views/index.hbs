<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Fashion HUB</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
        <link href="/style.css" rel="stylesheet" />
        <style>
            .wishlist-btn {
                position: absolute;
                top: 10px;
                right: 10px;
                background: rgba(255, 255, 255, 0.9);
                border: none;
                border-radius: 50%;
                width: 40px;
                height: 40px;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                transition: all 0.3s ease;
                z-index: 10;
            }
            
            .wishlist-btn:hover {
                background: rgba(255, 255, 255, 1);
                transform: scale(1.1);
            }
            
            .wishlist-btn i {
                font-size: 18px;
                color: #6c757d;
                transition: color 0.3s ease;
            }
            
            .wishlist-btn.active i {
                color: #dc3545;
            }
            
            .product-card {
                position: relative;
                transition: transform 0.3s ease;
            }
            
            .product-card:hover {
                transform: translateY(-5px);
            }
        </style>
    </head>
    <body>
        <!--Navbar-->
        <!-- New Navbar with the styling from the second example but content from original -->
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark text-uppercase fs-6 p-3 border-bottom align-items-center">
    <div class="container-fluid">
        <div class="row justify-content-between align-items-center w-100">
            
            <!-- Brand Logo -->
            <div class="col-auto">
                <a class="navbar-brand" href="/">Fashion HUB</a>
            </div>

            <!-- Toggle Button -->
            <div class="col-auto">
                <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
                    <div class="offcanvas-header">
                        <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Menu</h5>
                        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                    </div>

                    <div class="offcanvas-body">
                        <ul class="navbar-nav justify-content-end flex-grow-1 gap-1 gap-md-5 pe-3">
                            <li class="nav-item">
                                <a class="nav-link active" href="/">Home</a>
                            </li>

                            {{#if user}}
                            <li class="nav-item">
                                <a class="nav-link" href="/dashboard">Dashboard</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/dashboard#orders">Orders</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/dashboard#wishlist">Wishlist</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/dashboard#cart">Cart</a>
                            </li>
                            {{else}}
                            <li class="nav-item">
                                <a class="nav-link" href="/login">Login</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/register">Register</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/login">Dashboard</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/login">Orders</a>
                            </li>
                            {{/if}}
                        </ul>
                    </div>
                </div>
            </div>

            <!-- User Info and Icons -->
            <div class="col-3 col-lg-auto">
                <ul class="list-unstyled d-flex m-0">
                    {{#if user}}
                    <li class="d-none d-lg-block">
                        <span class="text-uppercase mx-3 text-white">Welcome, {{user.name}}</span>
                    </li>
                    <li class="d-none d-lg-block">
                        <a href="/auth/logout" class="text-uppercase mx-3 text-danger">Logout</a>
                    </li>
                    {{else}}
                    <!-- Wishlist and Cart hidden before login -->
                    {{/if}}

                    <li class="search-box">
                        <a href="#search" class="search-button text-white">
                            <svg width="24" height="24" viewBox="0 0 24 24">
                                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5
                                16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5
                                16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5
                                4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5
                                9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5
                                14z" fill="currentColor"></path>
                            </svg>
                        </a>
                    </li>
                </ul>
            </div>

        </div>
    </div>
</nav>


        <!--header-->
        <!--heroes-->
        <div class="px-4 pt-5 my-5 text-center border-bottom">
            <h1 class="display-4 fw-bold text-body-emphasis">Fashion HUB</h1>
            <div class="col-lg-6 mx-auto">
                <p class="lead mb-4">
                    Temukan koleksi fashion terbaru dari berbagai brand ternama. Dapatkan penawaran terbaik dan bergabunglah dengan komunitas fashion lovers di seluruh Indonesia.
                </p>
                <div class="d-grid gap-2 d-sm-flex justify-content-sm-center mb-5">
                    <button class="btn btn-primary btn-lg px-4 me-sm-3">Belanja Sekarang</button> 
                </div>
            </div>
            <div class="overflow-hidden" style="max-height: 30vh;">
                <div class="container px-5"><img src="/api/placeholder/700/500" class="img-fluid border rounded-3 shadow-lg mb-4" alt="Fashion showcase" width="700" height="500" loading="lazy" /></div>
            </div>
        </div>
        <!--features-->
        <div class="container px-4 py-5" id="hanging-icons">
            <h2 class="pb-2 border-bottom">Kenapa Memilih Fashion HUB?</h2>
            <div class="row g-4 py-5 row-cols-1 row-cols-lg-3">
                <div class="col d-flex align-items-start">
                    <div class="icon-square text-body-emphasis bg-body-secondary d-inline-flex align-items-center justify-content-center fs-4 flex-shrink-0 me-3">
                        <svg class="bi" width="1em" height="1em" aria-hidden="true"><use xlink:href="#toggles2"></use></svg>
                    </div>
                    <div>
                        <h3 class="fs-2 text-body-emphasis">Koleksi Terlengkap</h3>
                        <p>Temukan beragam pilihan fashion dari brand lokal hingga internasional dengan kualitas terbaik dan harga terjangkau.</p>
                        <a href="#" class="btn btn-primary">
                            Lihat Koleksi
                        </a>
                    </div>
                </div>
                <div class="col d-flex align-items-start">
                    <div class="icon-square text-body-emphasis bg-body-secondary d-inline-flex align-items-center justify-content-center fs-4 flex-shrink-0 me-3">
                        <svg class="bi" width="1em" height="1em" aria-hidden="true"><use xlink:href="#cpu-fill"></use></svg>
                    </div>
                    <div>
                        <h3 class="fs-2 text-body-emphasis">Pengiriman Cepat</h3>
                        <p>Dapatkan produk fashion impian Anda dengan layanan pengiriman ekspres ke seluruh Indonesia dalam 1-3 hari kerja.</p>
                        <a href="#" class="btn btn-primary">
                            Info Pengiriman
                        </a>
                    </div>
                </div>

                <div class="col d-flex align-items-start">
                    <div class="icon-square text-body-emphasis bg-body-secondary d-inline-flex align-items-center justify-content-center fs-4 flex-shrink-0 me-3">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clock" viewBox="0 0 16 16">
  <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71z"/>
  <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0"/>
</svg>
                    </div>
                    <div>
                        <h3 class="fs-2 text-body-emphasis">Customer Service 24/7</h3>
                        <p>Tim customer service kami siap membantu Anda kapan saja dengan layanan konsultasi fashion dan after-sales yang memuaskan.</p>
                        <a href="#" class="btn btn-primary">
                            Hubungi Kami
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <!--products-->
        <section id="new-arrival" class="new-arrival product-carousel py-5 position-relative overflow-hidden">
            <div class="container">
                <div class="d-flex flex-wrap justify-content-between align-items-center mt-5 mb-3">
                    <h4 class="text-uppercase">Koleksi Terbaru Kami</h4>
                    <a href="#" class="btn-link">Lihat Semua Produk</a>
                </div>
                <div class="row">
                    <div class="col-md-3 mb-4">
                        <div class="card border-0 shadow-sm product-card" data-product-id="1" data-product-name="Dark Florish Onepiece" data-product-price="950000">
                            <button class="wishlist-btn" onclick="toggleWishlist(this, 1)">
                                <i class="bi bi-heart"></i>
                            </button>
                            <img src="/api/placeholder/250/300" class="card-img-top" alt="Dark florish onepiece">
                            <div class="card-body">
                                <h5 class="card-title">Dark Florish Onepiece</h5>
                                <p class="card-text text-primary fw-bold">Rp 950.000</p>
                                <button class="btn btn-outline-primary btn-sm">Tambah ke Keranjang</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-4">
                        <div class="card border-0 shadow-sm product-card" data-product-id="2" data-product-name="Baggy Shirt" data-product-price="550000">
                            <button class="wishlist-btn" onclick="toggleWishlist(this, 2)">
                                <i class="bi bi-heart"></i>
                            </button>
                            <img src="/api/placeholder/250/300" class="card-img-top" alt="Baggy Shirt">
                            <div class="card-body">
                                <h5 class="card-title">Baggy Shirt</h5>
                                <p class="card-text text-primary fw-bold">Rp 550.000</p>
                                <button class="btn btn-outline-primary btn-sm">Tambah ke Keranjang</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-4">
                        <div class="card border-0 shadow-sm product-card" data-product-id="3" data-product-name="Cotton Off-White Shirt" data-product-price="650000">
                            <button class="wishlist-btn" onclick="toggleWishlist(this, 3)">
                                <i class="bi bi-heart"></i>
                            </button>
                            <img src="/api/placeholder/250/300" class="card-img-top" alt="Cotton off-white shirt">
                            <div class="card-body">
                                <h5 class="card-title">Cotton Off-White Shirt</h5>
                                <p class="card-text text-primary fw-bold">Rp 650.000</p>
                                <button class="btn btn-outline-primary btn-sm">Tambah ke Keranjang</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-4">
                        <div class="card border-0 shadow-sm product-card" data-product-id="4" data-product-name="Crop Sweater" data-product-price="500000">
                            <button class="wishlist-btn" onclick="toggleWishlist(this, 4)">
                                <i class="bi bi-heart"></i>
                            </button>
                            <img src="/api/placeholder/250/300" class="card-img-top" alt="Crop sweater">
                            <div class="card-body">
                                <h5 class="card-title">Crop Sweater</h5>
                                <p class="card-text text-primary fw-bold">Rp 500.000</p>
                                <button class="btn btn-outline-primary btn-sm">Tambah ke Keranjang</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Toast untuk notifikasi -->
        <div class="toast-container position-fixed bottom-0 end-0 p-3">
            <div id="wishlistToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="toast-header">
                    <i class="bi bi-heart-fill text-danger me-2"></i>
                    <strong class="me-auto">Wishlist</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
                <div class="toast-body">
                    <span id="toastMessage"></span>
                </div>
            </div>
        </div>

        <!-- Modal untuk konfirmasi login -->
        <div class="modal fade" id="loginRequiredModal" tabindex="-1" aria-labelledby="loginRequiredModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="loginRequiredModalLabel">Login Required</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body text-center">
                        <i class="bi bi-heart-fill text-danger" style="font-size: 3rem;"></i>
                        <h5 class="mt-3">Masuk ke Akun Anda</h5>
                        <p class="text-muted">Anda perlu masuk ke akun untuk menambahkan produk ke wishlist.</p>
                    </div>
                    <div class="modal-footer justify-content-center">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Nanti Saja</button>
                        <a href="/login" class="btn btn-primary">Masuk Sekarang</a>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
        
        <script>
            // Simulasi status login user (dalam aplikasi nyata, ini akan didapat dari server/session)
            // Ganti dengan logika authentikasi yang sebenarnya
            let isUserLoggedIn = false; // Set to true jika user sudah login
            let currentUser = null; // Data user yang sedang login
            
            // Dalam aplikasi nyata, Anda bisa menggunakan:
            // 1. Server-side rendering untuk inject data user
            // 2. AJAX call untuk check authentication status
            // 3. JWT token verification
            
            // Example: Check if user is logged in from server-side variable
            // isUserLoggedIn = typeof window.userLoggedIn !== 'undefined' ? window.userLoggedIn : false;
            // currentUser = typeof window.currentUser !== 'undefined' ? window.currentUser : null;

            // Array untuk menyimpan wishlist (dalam aplikasi nyata, ini akan disimpan di database)
            let wishlist = [];

            function toggleWishlist(button, productId) {
                // Cek apakah user sudah login
                if (!isUserLoggedIn) {
                    showLoginModal();
                    return;
                }

                const icon = button.querySelector('i');
                const productCard = button.closest('.product-card');
                const productName = productCard.dataset.productName;
                const productPrice = parseInt(productCard.dataset.productPrice);
                
                // Toggle active class pada button
                button.classList.toggle('active');
                
                // Toggle icon antara outline dan filled
                if (icon.classList.contains('bi-heart')) {
                    icon.classList.remove('bi-heart');
                    icon.classList.add('bi-heart-fill');
                    
                    // Tambah ke wishlist
                    if (!wishlist.find(item => item.product_id === productId)) {
                        const wishlistItem = {
                            id: Date.now(), // Temporary ID (dalam database akan auto-increment)
                            user_id: currentUser ? currentUser.id : null,
                            product_id: productId,
                            product_name: productName,
                            product_price: productPrice,
                            created_at: new Date().toISOString()
                        };
                        
                        wishlist.push(wishlistItem);
                        showToast(`${productName} ditambahkan ke wishlist!`);
                        
                        // Kirim ke server
                        addToWishlistOnServer(wishlistItem);
                    }
                } else {
                    icon.classList.remove('bi-heart-fill');
                    icon.classList.add('bi-heart');
                    
                    // Hapus dari wishlist
                    const itemToRemove = wishlist.find(item => item.product_id === productId);
                    wishlist = wishlist.filter(item => item.product_id !== productId);
                    showToast(`${productName} dihapus dari wishlist!`);
                    
                    // Hapus dari server
                    if (itemToRemove) {
                        removeFromWishlistOnServer(itemToRemove.id, productId);
                    }
                }
                
                console.log('Current wishlist:', wishlist);
            }

            function showLoginModal() {
                const modal = new bootstrap.Modal(document.getElementById('loginRequiredModal'));
                modal.show();
            }

            function showToast(message) {
                const toastElement = document.getElementById('wishlistToast');
                const toastBody = document.getElementById('toastMessage');
                toastBody.textContent = message;
                
                const toast = new bootstrap.Toast(toastElement);
                toast.show();
            }

            // Functions untuk komunikasi dengan server
            function addToWishlistOnServer(wishlistItem) {
                // AJAX call untuk menambah item ke wishlist di database
                fetch('/api/wishlist', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-TOKEN': getCsrfToken(), // Jika menggunakan CSRF protection
                    },
                    body: JSON.stringify({
                        product_id: wishlistItem.product_id,
                        user_id: wishlistItem.user_id
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        console.log('Item added to wishlist:', data);
                        // Update local wishlist dengan ID dari server
                        const localItem = wishlist.find(item => item.product_id === wishlistItem.product_id);
                        if (localItem) {
                            localItem.id = data.wishlist_id;
                        }
                    } else {
                        console.error('Failed to add to wishlist:', data);
                        showToast('Gagal menambahkan ke wishlist. Silakan coba lagi.');
                    }
                })
                .catch(error => {
                    console.error('Error adding to wishlist:', error);
                    showToast('Terjadi kesalahan. Silakan coba lagi.');
                });
            }

            function removeFromWishlistOnServer(wishlistId, productId) {
                // AJAX call untuk menghapus item dari wishlist di database
                fetch('/api/wishlist/' + wishlistId, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRF-TOKEN': getCsrfToken(), // Jika menggunakan CSRF protection
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        console.log('Item removed from wishlist:', data);
                    } else {
                        console.error('Failed to remove from wishlist:', data);
                        showToast('Gagal menghapus dari wishlist. Silakan coba lagi.');
                    }
                })
                .catch(error => {
                    console.error('Error removing from wishlist:', error);
                    showToast('Terjadi kesalahan. Silakan coba lagi.');
                });
            }

            function loadWishlistFromServer() {
                if (!isUserLoggedIn) return;
                
                // AJAX call untuk mengambil wishlist dari server
                fetch('/api/wishlist')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        wishlist = data.wishlist;
                        updateWishlistUI();
                        console.log('Wishlist loaded from server:', wishlist);
                    }
                })
                .catch(error => {
                    console.error('Error loading wishlist:', error);
                });
            }

            // Update UI berdasarkan data wishlist yang ada
            function updateWishlistUI() {
                wishlist.forEach(item => {
                    const productCard = document.querySelector(`[data-product-id="${item.product_id}"]`);
                    if (productCard) {
                        const button = productCard.querySelector('.wishlist-btn');
                        const icon = button.querySelector('i');
                        button.classList.add('active');
                        icon.classList.remove('bi-heart');
                        icon.classList.add('bi-heart-fill');
                    }
                });
            }

            // Helper function untuk mendapatkan CSRF token (jika diperlukan)
            function getCsrfToken() {
                const token = document.querySelector('meta[name="csrf-token"]');
                return token ? token.getAttribute('content') : '';
            }

            // Function untuk set user login status (dipanggil setelah login berhasil)
            function setUserLoggedIn(user) {
                isUserLoggedIn = true;
                currentUser = user;
                loadWishlistFromServer();
            }

            // Function untuk logout
            function logoutUser() {
                isUserLoggedIn = false;
                currentUser = null;
                wishlist = [];
                // Reset semua heart icons ke state kosong
                document.querySelectorAll('.wishlist-btn').forEach(button => {
                    const icon = button.querySelector('i');
                    button.classList.remove('active');
                    icon.classList.remove('bi-heart-fill');
                    icon.classList.add('bi-heart');
                });
            }

            // Panggil saat halaman dimuat
            document.addEventListener('DOMContentLoaded', function() {
                // Dalam aplikasi nyata, check authentication status dari server
                // checkAuthenticationStatus();
                
                // Load wishlist jika user sudah login
                loadWishlistFromServer();
            });

            // Example function untuk check authentication status dari server
            function checkAuthenticationStatus() {
                fetch('/api/auth/check')
                .then(response => response.json())
                .then(data => {
                    if (data.authenticated) {
                        setUserLoggedIn(data.user);
                    }
                })
                .catch(error => {
                    console.error('Error checking authentication:', error);
                });
            }
        </script>
    </body>
</html>